<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Medication Tracker</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header class="sticky-header">
    <h1>Medication Tracker</h1>
    <nav>
      <button onclick="renderMedsGrouped()">ðŸ“‹ Medications</button>
      <button onclick="showStockManager()">ðŸ’Š Stock</button>
      <button onclick="viewWeeklyTimeline()">ðŸ“† Weekly</button>
      <button onclick="renderAdherenceChart()">ðŸ“Š Chart</button>
      <button onclick="showHistory()">ðŸ•“ History</button>
      <button onclick="exportLogs()">ðŸ“„ Export</button>
      <button onclick="toggleTheme()" id="themeToggle">ðŸŒ“</button>
      <button onclick="switchUser()" style="float:right;">ðŸ”„ Switch User</button>
    </nav>
  </header>
  <main>
    <section id="medListSection">
      <h2 class="section-title">Medications</h2>
      <div id="medList"></div>
    </section>
    <section id="stockManagerSection" style="display:none;">
      <h2 class="section-title">Stock Manager</h2>
      <div id="stockManager"></div>
    </section>
    <section id="weeklyViewSection" style="display:none;">
      <h2 class="section-title">Weekly Timeline</h2>
      <div id="weeklyView"></div>
    </section>
    <section id="chartSection" style="display:none;">
      <h2 class="section-title">Adherence Chart</h2>
      <canvas id="adherenceChart"></canvas>
      <div style="margin:10px 0;">
        <label for="chartRange">View:</label>
        <select id="chartRange" onchange="renderAdherenceChart()">
          <option value="7">Last 7 days</option>
          <option value="30">Last 30 days</option>
          <option value="all">All time</option>
        </select>
      </div>
    </section>
    <section id="historySection" style="display:none;">
      <h2 class="section-title">History</h2>
      <div id="history"></div>
      <button onclick="exportLogs()">Export History as CSV</button>
    </section>
    <section id="calendarLog" class="calendar-view"></section>
    <form id="medForm">
      <input type="text" id="medName" placeholder="Medication Name" required />
      <input type="number" id="qty" placeholder="Quantity per dose" required />
      <input type="number" id="dosesPerDay" placeholder="Doses per day" required />
      <div class="recurrence-options">
        <label><input type="radio" name="repeatType" value="recurring" id="recurring" /> Recurring Daily</label>
        <label><input type="radio" name="repeatType" value="fixed" id="fixedPeriod" /> Fixed Period</label>
        <input type="number" id="weeks" placeholder="Weeks" style="display:none;" />
      </div>
      <button type="submit">Add Medication</button>
    </form>
    <button onclick="resetData()">ðŸ§¹ Reset My Data</button>
    <button onclick="exportLogs()">ðŸ“¤ Export My Medication Log</button>
  </main>
  <script>
    function switchUser() {
      localStorage.removeItem('currentUser');
      window.location.href = 'user.html';
    }
    function toggleTheme() {
      document.body.classList.toggle("dark");
      localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
    }
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
    }
    function resetData() {
      if (confirm("This will erase all medication data for this user. Proceed?")) {
        localStorage.removeItem(currentUser + '_medications');
        localStorage.removeItem(currentUser + '_medLogs');
        location.reload();
      }
    }
  </script>
</body>
</html>
