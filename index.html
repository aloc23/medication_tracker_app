<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Medication Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="icon" href="icon-192.png" sizes="192x192" />
  <meta name="theme-color" content="#26a69a" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="header-content">
      <h1>Medication Tracker</h1>
      <button class="user-switch-btn" onclick="location.href='user.html'">
        <i class="fas fa-user-circle"></i>
        <span class="user-label">Switch User</span>
      </button>
    </div>
  </header>
  
  <!-- Desktop Navigation -->
  <nav class="desktop-nav">
    <div class="nav-container">
      <button class="nav-btn active" data-section="medListSection" onclick="showMedications()">
        <i class="fas fa-pills"></i>
        <span>Medications</span>
      </button>
      <button class="nav-btn" data-section="addMedSection" onclick="showAddMedication()">
        <i class="fas fa-plus-circle"></i>
        <span>Add Medication</span>
      </button>
      <button class="nav-btn" data-section="calendarSection" onclick="showCalendar()">
        <i class="fas fa-calendar-alt"></i>
        <span>Calendar</span>
      </button>
      <button class="nav-btn" data-section="stockManagerSection" onclick="showStockManager()">
        <i class="fas fa-boxes"></i>
        <span>Stock</span>
      </button>
      <button class="nav-btn" data-section="historySection" onclick="showHistory()">
        <i class="fas fa-chart-line"></i>
        <span>History</span>
      </button>
      <button class="nav-btn" data-section="medChangeHistorySection" onclick="showMedChangeHistory()">
        <i class="fas fa-history"></i>
        <span>Changes</span>
      </button>
    </div>
  </nav>
  
  <!-- Mobile Bottom Navigation -->
  <nav class="mobile-nav">
    <button class="mobile-nav-btn active" data-section="medListSection" onclick="showMedications()">
      <i class="fas fa-pills"></i>
      <span>Meds</span>
    </button>
    <button class="mobile-nav-btn" data-section="addMedSection" onclick="showAddMedication()">
      <i class="fas fa-plus-circle"></i>
      <span>Add</span>
    </button>
    <button class="mobile-nav-btn" data-section="calendarSection" onclick="showCalendar()">
      <i class="fas fa-calendar-alt"></i>
      <span>Calendar</span>
    </button>
    <button class="mobile-nav-btn" data-section="stockManagerSection" onclick="showStockManager()">
      <i class="fas fa-boxes"></i>
      <span>Stock</span>
    </button>
    <button class="mobile-nav-btn" data-section="historySection" onclick="showHistory()">
      <i class="fas fa-chart-line"></i>
      <span>History</span>
    </button>
  </nav>
  <main class="app-main">
    <section id="medListSection" class="content-section active">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-pills"></i> Your Medications</h2>
      </div>
      <div id="medList" class="medication-list"></div>
      <div class="action-buttons">
        <div class="export-group">
          <h3>Export Options</h3>
          <button class="export-btn" onclick="exportMedListPDF()">
            <i class="fas fa-file-pdf"></i> PDF
          </button>
          <button class="export-btn" onclick="exportMedListJPEG()">
            <i class="fas fa-image"></i> JPEG
          </button>
          <button class="export-btn" onclick="exportCurrentMedListExcel()">
            <i class="fas fa-file-excel"></i> Excel
          </button>
          <button class="export-btn" onclick="exportMedicationListCSV()">
            <i class="fas fa-file-csv"></i> CSV
          </button>
        </div>
        <div class="backup-group">
          <h3>Backup & Restore</h3>
          <button class="backup-btn export-btn" id="btnExportBackup">
            <i class="fas fa-download"></i> Export Backup
          </button>
          <input id="fileImport" type="file" accept="application/json" style="display:none" />
          <button class="backup-btn import-btn" id="btnImportBackup">
            <i class="fas fa-upload"></i> Import Backup
          </button>
        </div>
        <button id="resetDataBtn" class="reset-btn">
          <i class="fas fa-trash-alt"></i> Reset All Data
        </button>
      </div>
    </section>
    <section id="addMedSection" class="content-section" style="display:none;">
      <div class="section-header">
        <h2 class="section-title" id="addMedSectionTitle"><i class="fas fa-plus-circle"></i> Add Medication</h2>
      </div>
      <form id="addMedForm" class="medication-form" autocomplete="off">
        <div class="form-group">
          <label for="addMedName">Medication Name</label>
          <input id="addMedName" type="text" placeholder="Enter medication name" required maxlength="40" />
        </div>
        <div class="form-group">
          <label for="addQty">Dose Amount</label>
          <input id="addQty" type="number" placeholder="Number of pills/mg" required min="1" max="1000" />
        </div>
        <div class="form-group">
          <label>Dose Times</label>
          <div id="addTimeInputs" class="time-inputs"></div>
          <button type="button" id="addTimeBtn" class="secondary-btn" onclick="addTimeInputToAddForm()">
            <i class="fas fa-clock"></i> Add Dose Time
          </button>
        </div>
        <div class="form-group">
          <label for="addMedNotes">Instructions</label>
          <textarea id="addMedNotes" placeholder="e.g., take with food, after meals..." rows="3" maxlength="120"></textarea>
        </div>
        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" id="addRecursDaily" checked>
            <span class="checkmark"></span>
            Repeat Daily
          </label>
        </div>
        <div id="addRecurrencePeriod" class="form-group date-range-group" style="display:none;">
          <div class="date-inputs">
            <div class="date-input">
              <label for="addRecStart">Start date</label>
              <input type="date" id="addRecStart">
            </div>
            <div class="date-input">
              <label for="addRecEnd">End date</label>
              <input type="date" id="addRecEnd">
            </div>
          </div>
        </div>
        <div class="form-group upload-group">
          <label for="uploadMedSheet" class="upload-label">
            <i class="fas fa-upload"></i>
            <span>Or upload from spreadsheet</span>
            <input type="file" id="uploadMedSheet" accept=".xlsx,.xls,.csv" />
          </label>
        </div>
        <div class="form-actions">
          <button type="submit" id="addMedSubmitBtn" class="primary-btn">Add Medication</button>
          <button type="button" id="addMedCancelBtn" class="secondary-btn" style="display:none;" onclick="cancelEditMedication()">Cancel</button>
        </div>
      </form>
    </section>
    <section id="medChangeHistorySection" class="content-section" style="display:none;">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-history"></i> Change History</h2>
      </div>
      <!-- JS renders full sidebar and details here -->
    </section>
    <section id="calendarSection" class="content-section" style="display:none;">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Calendar</h2>
      </div>
      <div id="calendarNav" class="calendar-navigation"></div>
      <div id="calendar" class="calendar-grid"></div>
      <div id="calendarDayDetail" class="calendar-detail"></div>
      <div class="collapsible" onclick="toggleWeeklyTimeline()">
        <span><i class="fas fa-calendar-week"></i> Weekly Timeline</span>
        <span id="weeklyCollapseIcon" class="collapse-icon">[+]</span>
      </div>
      <div id="weeklyCollapsible" class="collapsible-content" style="display:none;">
        <div id="weeklyView"></div>
      </div>
    </section>
    <section id="stockManagerSection" class="content-section" style="display:none;">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-boxes"></i> Stock Management</h2>
      </div>
      <div id="stockManager" class="stock-container"></div>
    </section>
    <section id="historySection" class="content-section" style="display:none;">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-chart-line"></i> Medication History</h2>
      </div>
      <div id="history" class="history-container"></div>
      <div class="action-buttons">
        <button id="exportCsvBtn" class="export-btn" onclick="exportLogs()">
          <i class="fas fa-file-csv"></i> Export CSV
        </button>
      </div>
      <div class="collapsible" onclick="toggleAdherenceChart()">
        <span><i class="fas fa-chart-bar"></i> Adherence Chart</span>
        <span id="adherenceCollapseIcon" class="collapse-icon">[+]</span>
      </div>
      <div id="adherenceCollapsible" class="collapsible-content" style="display:none;">
        <canvas id="adherenceChart"></canvas>
        <select id="chartRange" class="chart-range-select" onchange="renderAdherenceChart()">
          <option value="7">Last 7 days</option>
          <option value="30">Last 30 days</option>
          <option value="all">All time</option>
        </select>
      </div>
    </section>
    <div id="toast" style="display:none;" class="toast"></div>
  </main>
  <script src="app.js"></script>
</body>
</html>
